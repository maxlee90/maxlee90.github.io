### 4. Gradle Build

1. 빌드란 무엇인가

소프트웨어 빌드는 소스 코드 파일을 컴퓨터에서 실행할 수 있는 독립 소프트웨어 가공물로 변환하는 과정 또는 그 결과를 일컫는다.

언어에 따라 결과물이 다르며, 빌드 대상에 따라 어떤 액션을 취하는 것이 빌드 툴에서의 빌드이다.

Gradle에서 실행 단위는 Task이며, 이러한 **태스크를 실행하는 것을 빌드**라고 한다.

2. 빌드의 입력 정보

Gradle이 참조하는 입력 정보들
- *초기화 스크립트(init.gradle) : 초기 설정하는 스크립트
- *설정 스크립트(settings.gradle) : 빌드에 포함할 프로젝트를 정의하는데 사용
- *빌드 스크립트(build.gradle) : 빌드의 정의를 기술하는 스크립트
- 속성 파일(gradle.properties) : 표준으로 참조하는 속성 파일로, 파라미터를 밖에 기술할 때 작성 
- 환경 변수 / 명령줄 인수 : 설치된 장비의 환경 변수와 빌드 실행시 명령줄에서 전달하는 인수를 의미
- buildSrc 프로젝트 : 빌드 시 참조하는 클래스 파일이나 자체 플러그인을 저장할 때 사용

---

### 아키텍처와 주요 기능

Gradle은 크게 본체와 플러그인으로 나눌 수 있다.

플러그인은 구체적인 처리를 위한 기능 모듈로 스크립트 파일에서 지정하지 않는 한 로드되지 않는다.

본체는 빌드 실행을 **지탱하는 구조**와 **표준 기능**을 제공한다.

1. 실행을 지탱하는 기술

- 설정 자동 로드 : 환경에 따라 Gradle의 설정이나 동작을 변경하고 싶다면 실행 환경의 고유한 설정이나 직접 정의한 동작을 자동으로 불러올 수 있다
- 프로젝트 탐색 : 싱글/멀티 프로젝트를 지원한다
- 태스크 그래프 : 빌드 생명 주기 중 가장 중요한 구조는 빌드로 실행한 태스크를 유지하는 태스크 그래프이다

2. Gradle의 표준 기능

- 파일 조작 : 코드 빌드에서는 컴파일 후 파일 출력 위치를 작성하거나 빌드 과정에서 생성되는 중간 파일을 삭제하는 작업처럼 파일 시스템을 조작해야 할 일이 많다. Gradle은 간단하게 파일 조작을 하도록 해준다
- 로그 : 빌드가 실행되는 도중 상태를 알려면 처리 상태나 처리 중에 발생한 문제를 출력하는 기능이 필요하다 (자체 로그 기능으로 출력 제어 가능)

--- 

### 설정 자동 로드하기

1. 초기화 스크립트로 설정

초기화 스크립트는 빌드 생명 주기의 초기화 단계에서 로드되므로 빌드 실행시 환경을 설정하는데 적합하다. 
```
allprojects{
  repositories{
    mavenCentral()
  }
}
```
초기화 스크립트는 명령줄 인수로 지정할 수 있지만, 본체에 둘 수도 있다.

2. 속성 파일을 이용해서 설정

Gradle이 자동으로 불러오는 속성 파일은 환경 설정에 적합하다.
```
systemProp.http.proxyHost=proxy.example.com
systemProp.http.proxyPort=8080
systemProp.http.proxyUser=userid
systemProp.http.proxyPassword=password
systemProp.http.nonProxyHosts=interval.site.co.kr|localhost
```
속성 파일도 역시 여러곳에 둘 수 있다. 하지만 같은 속성을 설정하는 속성 파일이 여러 곳에 있다면 마지막에 불러온 속성 파일의 설정이 적용된다.

--- 

### 프로젝트 탐색

Gradle은 빌드를 실행할 때 **프로젝트** 단위로 대상 영역을 찾는다. 싱글 프로젝트일 경우 gradle 명령이 실행하는 현재 디렉터리가 빌드 대상 프로젝트가 된다. 즉, 루트 프로젝트이다.

하지만 멀티 프로젝트에서는 루트 프로젝트 아래에 빌드에 포함되는 프로젝트가 추가되는 구조다. 멀티 프로젝트에서는 루트 프로젝트 이외의 프로젝트에서도 명령을 실행할 수 있으므로 현재 프로젝트와 루트 프로젝트가 일치하지 않을 수도 있다.

Gradle은 싱글/멀티 프로젝트를 모두 지원하기 때문에, 빌드 실행전에 현재 프로젝트가 싱글 or 멀티 프로젝트인지 판정해야한다. 이러한 판정은 설정 스크립트(settings.gradle)에서 설정한다. 

- 설정 스크립트는 루트 프로젝트 바로 아래에 둔다.
- 멀티 프로젝트는 반드시 설정 스크립트가 있어야 한다.

Gradle이 설정 파일을 찾는 방법
1. 현재 디렉터리에 settings.gradle이 있으면 이를 설정 파일로 간주한다
2. 상위 디렉터리에 settings.gradle이 있으면 이를 설정파일로 간주한다
3. 현재 디렉터리와 같은 계층에 master 디렉터리가 있고 그 아래 settings.gradle이 있으면 이를 설정 파일로 간주한다
